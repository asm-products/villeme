// Generated by CoffeeScript 1.7.1
$(document).ready(function() {
  var loadmap_builder, money, mostraEventos, mostraSidebarMap, position, teste, timeFadeIn, timeFadeOut, timeTimeOut, timeouts;
  timeouts = [];
  $("#main").fadeIn();
  $(document).on('page:loading', function() {
    $("#main").fadeOut(450);
  });
  $(document).on('page:done', function() {
    $("#main").fadeIn(600);
  });
  timeFadeIn = 800;
  timeFadeOut = 600;
  timeTimeOut = 600;
  teste = $(".event .panel").mouseenter(function() {
    var i, latLng, letra, map, marker;
    i = 0;
    while (i < timeouts.length) {
      clearTimeout(timeouts[i]);
      i++;
    }
    timeouts = [];
    $(this).find(".letter").fadeIn("fast");
    letra = $(this).find(".letter").text();
    $(".address").fadeIn("fast").text($(this).attr("address"));
    $(".bus .data").fadeIn("fast").text($(this).attr("bus"));
    latLng = new google.maps.LatLng($(this).attr("latitude"), $(this).attr("longitude"));
    marker = $("#user-map").gmap3({
      get: {
        id: $(this).attr("letter")
      }
    });
    map = $("#user-map").gmap3("get");
    map.panTo(latLng);
    marker.setAnimation(google.maps.Animation.BOUNCE);
    marker.setZIndex(10);
  });
  $(".event .panel").mouseleave(function() {
    var latLng, map, marker, pan;
    $(".infobox").hide().text("");
    $(this).find(".letter").fadeOut("fast");
    latLng = new google.maps.LatLng(gon.latitude, gon.longitude);
    marker = $("#user-map").gmap3({
      get: {
        id: $(this).attr("letter")
      }
    });
    map = $("#user-map").gmap3("get");
    pan = function() {
      map.panTo(latLng);
    };
    timeouts.push(setTimeout(pan, 6500));
    marker.setAnimation(null);
    marker.setZIndex(1);
  });
  $("#user-map").mouseenter(function() {
    var i;
    i = 0;
    while (i < timeouts.length) {
      clearTimeout(timeouts[i]);
      i++;
    }
    timeouts = [];
  });
  position = $(window).scrollTop();
  $(window).scroll(function() {
    clearTimeout($.data(this, "scrollTimer"));
    $.data(this, "scrollTimer", setTimeout(function() {
      var scroll;
      scroll = $(window).scrollTop();
      if (scroll > position) {
        $(".header-fixed").animate({
          top: -70
        }, 250);
      } else {
        $(".header-fixed").animate({
          top: 0
        }, 250);
      }
      position = scroll;
    }, 250));
  });
  loadmap_builder = function(latitude, longitude) {
    var centralizeMap, gmap_clear_markers, map, style;
    style = [
      {
        "featureType": "road",
        "elementType": "geometry",
        "stylers": [
          {
            "lightness": 100
          }, {
            "visibility": "simplified"
          }
        ]
      }, {
        "featureType": "water",
        "elementType": "geometry",
        "stylers": [
          {
            "visibility": "on"
          }, {
            "color": "#d6defa"
          }
        ]
      }, {
        "featureType": "poi.business",
        "stylers": [
          {
            "visibility": "off"
          }
        ]
      }, {
        "featureType": "poi",
        "elementType": "geometry.fill",
        "stylers": [
          {
            "color": "#dff5e6"
          }
        ]
      }, {
        "featureType": "road",
        "elementType": "geometry.fill",
        "stylers": [
          {
            "color": "#D1D1B8"
          }
        ]
      }, {
        "featureType": "landscape",
        "elementType": "geometry.fill",
        "stylers": [
          {
            "color": "#ffffff"
          }
        ]
      }
    ];
    $("#user-map").fadeIn();
    $("#load-map").gmap3({
      map: {
        options: {
          center: [latitude, longitude],
          zoom: 15,
          mapTypeId: google.maps.MapTypeId.ROADMAP,
          mapTypeControl: false,
          mapTypeControlOptions: {
            style: google.maps.MapTypeControlStyle.DROPDOWN_MENU
          },
          navigationControl: false,
          scrollwheel: true,
          streetViewControl: false,
          zoomControl: false,
          styles: style
        }
      },
      marker: {
        values: gon.events_local_formatted,
        options: {
          draggable: true
        },
        events: {
          mouseover: function(marker, event, context) {},
          mouseout: function() {
            $(".infobox").fadeOut("fast");
          },
          click: function(marker, event, context) {
            $.ajax({
              url: context.data.link + ".json"
            }).done(function(data) {
              $("#load-event .clear").html("");
              $("#load-event .load-title").html(data.event.name);
              $("#load-event .load-image img").attr("src", data.image);
              $("#load-event .load-body > p").html(data.event.description);
              jQuery.each(data.event_categories, function(i, val) {
                $("#load-event .load-categories").append("<div class='item " + val.name.toLowerCase() + "'>" + val.name + "</div>");
              });
            });
          }
        }
      }
    });
    map = $("#load-map").gmap3("get");
    centralizeMap = function() {
      var latlng;
      latlng = new google.maps.LatLng(latitude, longitude);
      google.maps.event.trigger(map, "resize");
      map.setCenter(latlng);
    };
    setTimeout(centralizeMap, 300);
    gmap_clear_markers = function() {
      $(".infobox").each(function() {
        $(this).remove();
      });
    };
    $("#botao").click(function() {
      var endereco;
      endereco = $("#endereco").val();
      buscaLatlong(endereco);
    });
  };
  money = function(value) {
    var digits;
    digits = value.length - 2;
    return "R$" + value.slice(0, digits) + "," + value.slice(-2);
  };
  $(".has-tooltip").tooltip();
  mostraEventos = function() {
    $("li.event").fadeIn(timeFadeIn);
  };
  mostraSidebarMap = function() {
    $("#sidebar-map").fadeIn(timeFadeIn);
  };
  $(".load-close").click(function() {
    $(".event").fadeOut(timeFadeOut);
    $("#load-event-sidebar").fadeOut(timeFadeOut);
    $(".tabrow").show();
    $(".tabclose").hide();
    setTimeout(mostraSidebarMap, timeTimeOut);
    setTimeout(mostraEventos, timeTimeOut);
  });
});
